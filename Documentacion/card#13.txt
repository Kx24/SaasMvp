# ğŸ“‹ CARD #13: Arreglar AutenticaciÃ³n - GuÃ­a de ImplementaciÃ³n

## âœ… Archivos a Crear/Modificar

### 1. MODIFICAR: config/urls.py
**AcciÃ³n:** ğŸ”„ REEMPLAZAR todo el contenido

**Ruta:** `config/urls.py`

**Fuente:** `config_urls.py`

**Cambios clave:**
- Django Admin movido de `/admin/` a `/superadmin/`
- Nueva ruta `/auth/` para login/logout custom
- PersonalizaciÃ³n de Django Admin

---

### 2. CREAR: apps/website/auth_urls.py
**AcciÃ³n:** â• CREAR nuevo archivo

**Ruta:** `apps/website/auth_urls.py`

**Fuente:** `apps_website_auth_urls.py`

**Contiene:**
- `/auth/login/` â†’ client_login
- `/auth/logout/` â†’ client_logout

---

### 3. CREAR: apps/website/auth_views.py
**AcciÃ³n:** â• CREAR nuevo archivo

**Ruta:** `apps/website/auth_views.py`

**Fuente:** `apps_website_auth_views.py`

**Contiene:**
- `client_login()` - Login custom con redirect a home
- `client_logout()` - Logout con mensaje y redirect

---

### 4. CREAR: templates/auth/login.html
**AcciÃ³n:** â• CREAR nuevo archivo

**Ruta:** `templates/auth/login.html`

**Fuente:** `templates_auth_login.html`

**CaracterÃ­sticas:**
- DiseÃ±o con Tailwind CSS
- Logo del cliente
- Mensajes de error/Ã©xito
- Responsive

---

### 5. MODIFICAR: templates/components/navbar.html
**AcciÃ³n:** ğŸ”„ REEMPLAZAR todo el contenido

**Ruta:** `templates/components/navbar.html`

**Fuente:** `templates_components_navbar_updated.html`

**Cambios clave:**
- Detecta si usuario estÃ¡ logueado
- Muestra botÃ³n "Admin" solo a superadmin
- Muestra "Dashboard" a usuarios logueados
- Link correcto a `/auth/login/`
- Link correcto a `/auth/logout/`
- MenÃº mobile actualizado

---

## ğŸš€ Pasos de ImplementaciÃ³n

### PASO 1: Actualizar config/urls.py

```bash
# 1. Abrir config/urls.py
# 2. Reemplazar TODO el contenido con config_urls.py
# 3. Guardar
```

---

### PASO 2: Crear auth_urls.py

```bash
# 1. Crear archivo apps/website/auth_urls.py
# 2. Copiar contenido de apps_website_auth_urls.py
# 3. Guardar
```

---

### PASO 3: Crear auth_views.py

```bash
# 1. Crear archivo apps/website/auth_views.py
# 2. Copiar contenido de apps_website_auth_views.py
# 3. Guardar
```

---

### PASO 4: Crear template de login

```bash
# 1. Crear carpeta templates/auth/ (si no existe)
# 2. Crear archivo templates/auth/login.html
# 3. Copiar contenido de templates_auth_login.html
# 4. Guardar
```

---

### PASO 5: Actualizar navbar

```bash
# 1. Abrir templates/components/navbar.html
# 2. Reemplazar TODO el contenido con templates_components_navbar_updated.html
# 3. Guardar
```

---

## ğŸ§ª Testing Local

### Test 1: Django Admin ahora en /superadmin/

```bash
# 1. Iniciar servidor
python manage.py runserver

# 2. Ir a http://127.0.0.1:8000/admin/
# Resultado esperado: 404 Not Found

# 3. Ir a http://127.0.0.1:8000/superadmin/
# Resultado esperado: Django Admin login
```

âœ… **Correcto:** Admin ahora estÃ¡ en /superadmin/

---

### Test 2: Login Cliente Funciona

```bash
# 1. Ir a http://127.0.0.1:8000/
# 2. Clic en "Iniciar SesiÃ³n"
# 3. Debe ir a /auth/login/
# 4. Login con usuario de prueba
# 5. Debe redirigir a home (/)
# 6. Navbar debe mostrar "Dashboard" y "Cerrar SesiÃ³n"
```

âœ… **Correcto:** Login funciona y redirige a home

---

### Test 3: Logout Funciona

```bash
# 1. Estando logueado
# 2. Clic en "Cerrar SesiÃ³n"
# 3. Debe redirigir a home (/)
# 4. Navbar debe mostrar "Iniciar SesiÃ³n"
# 5. Debe aparecer mensaje "Hasta pronto, [usuario]!"
```

âœ… **Correcto:** Logout funciona sin errores

---

### Test 4: Superadmin tiene acceso especial

```bash
# 1. Login con superadmin (admin / admin123)
# 2. En navbar debe aparecer botÃ³n "ğŸ”§ Admin"
# 3. Clic en "Admin" â†’ va a /superadmin/
# 4. TambiÃ©n debe tener acceso a "Dashboard"
```

âœ… **Correcto:** Superadmin tiene botÃ³n especial

---

### Test 5: Cliente NO ve botÃ³n Admin

```bash
# 1. Crear usuario normal (no superadmin)
# 2. Login con ese usuario
# 3. En navbar NO debe aparecer botÃ³n "Admin"
# 4. Solo debe ver "Dashboard" y "Cerrar SesiÃ³n"
```

âœ… **Correcto:** Cliente normal no ve Admin

---

## ğŸ› Troubleshooting

### Error: "Reverse for 'client_login' not found"

**Causa:** auth_urls.py no estÃ¡ incluido o tiene errores

**SoluciÃ³n:**
1. Verificar que `apps/website/auth_urls.py` existe
2. Verificar que `config/urls.py` tiene:
   ```python
   path('auth/', include('apps.website.auth_urls')),
   ```
3. Reiniciar servidor

---

### Error: "Template 'auth/login.html' not found"

**Causa:** Template no existe o estÃ¡ mal ubicado

**SoluciÃ³n:**
1. Verificar que existe `templates/auth/login.html`
2. Verificar que `templates/` estÃ¡ en TEMPLATES dirs
3. Reiniciar servidor

---

### Error: DespuÃ©s de login sigue en login page

**Causa:** Redirect no funciona o sesiÃ³n no se guarda

**SoluciÃ³n:**
1. Verificar que `login(request, user)` se ejecuta
2. Verificar que `redirect('home')` existe
3. Ver logs del servidor para errores
4. Verificar que SESSION_COOKIE estÃ¡ configurado

---

### Error: Al hacer logout da error 500

**Causa:** Problema en redirect o mensajes

**SoluciÃ³n:**
1. Verificar que `client_logout` tiene `@login_required`
2. Verificar que `logout(request)` se ejecuta antes de redirect
3. Verificar que `messages.success` funciona
4. Ver traceback en logs

---

## ğŸ“Š Cambios Realizados - Resumen

### URLs
- âŒ `/admin/` â†’ âœ… `/superadmin/` (Django Admin)
- â• `/auth/login/` (Login custom)
- â• `/auth/logout/` (Logout custom)

### Vistas
- â• `client_login()` - Login con redirect a home
- â• `client_logout()` - Logout con mensaje

### Templates
- â• `templates/auth/login.html` - Login con Tailwind
- ğŸ”„ `templates/components/navbar.html` - Navbar dinÃ¡mico

### Comportamiento
- âœ… Login â†’ Redirige a home (con botones editar)
- âœ… Logout â†’ Redirige a home (con mensaje)
- âœ… Superadmin ve botÃ³n "Admin"
- âœ… Cliente NO ve botÃ³n "Admin"
- âœ… No hay errores en login/logout

---

## ğŸ¯ Definition of Done - Checklist

### Archivos
- [ ] `config/urls.py` actualizado
- [ ] `apps/website/auth_urls.py` creado
- [ ] `apps/website/auth_views.py` creado
- [ ] `templates/auth/login.html` creado
- [ ] `templates/components/navbar.html` actualizado

### Funcionalidad
- [ ] Django Admin en `/superadmin/`
- [ ] Login funciona en `/auth/login/`
- [ ] Login redirige a home
- [ ] Logout funciona sin errores
- [ ] Logout redirige a home
- [ ] Navbar muestra estado correcto
- [ ] Superadmin ve botÃ³n "Admin"
- [ ] Cliente NO ve botÃ³n "Admin"
- [ ] Mensajes de Ã©xito/error funcionan

### Testing
- [ ] Test 1: Admin en /superadmin/ âœ“
- [ ] Test 2: Login funciona âœ“
- [ ] Test 3: Logout funciona âœ“
- [ ] Test 4: Superadmin acceso especial âœ“
- [ ] Test 5: Cliente sin botÃ³n Admin âœ“

---

## ğŸš€ Siguiente Paso

Una vez completado Card #13:

**Card #14: Extender Modelos**
- Agregar campo `description` a Section
- Agregar campo `description` a Service
- MigraciÃ³n
- Actualizar Admin
- Actualizar Forms

**Tiempo estimado:** 1-2 horas

---

## ğŸ’¡ Notas Importantes

### Diferencia entre /superadmin/ y /dashboard/

```
/superadmin/ (Django Admin)
â”œâ”€â”€ Solo superadmin
â”œâ”€â”€ GestiÃ³n de tenants
â”œâ”€â”€ Ver todo el contenido (read-only)
â””â”€â”€ Crear usuarios

/dashboard/ (Dashboard Custom)
â”œâ”€â”€ Todos los usuarios logueados
â”œâ”€â”€ Gestionar SU contenido
â”œâ”€â”€ Ver SUS estadÃ­sticas
â””â”€â”€ Editar SUS secciones/servicios
```

### Flujo de AutenticaciÃ³n

```
Usuario NO logueado:
    Click "Iniciar SesiÃ³n"
    â†’ /auth/login/
    â†’ Formulario de login
    â†’ AutenticaciÃ³n
    â†’ Redirect a home (/)
    â†’ Ve botones de ediciÃ³n

Usuario logueado:
    Navega normalmente
    â†’ Ve botones "Dashboard" y "Cerrar SesiÃ³n"
    â†’ Puede editar su contenido
    
Superadmin logueado:
    Navega normalmente
    â†’ Ve botones "Admin", "Dashboard", "Cerrar SesiÃ³n"
    â†’ Puede acceder a Django Admin
    â†’ Puede gestionar tenants
```

---

**Â¿Listo para implementar?** ğŸš€

Sigue los pasos en orden y verifica cada test antes de continuar.