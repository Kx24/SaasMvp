# render.yaml - Configuración de Render para SaaS MVP Multi-Tenant
# ==================================================================
#
# Este archivo define la infraestructura en Render:
# - Web service (Django app)
# - PostgreSQL database
#
# Para desplegar: conecta tu repo de GitHub a Render
# Render detectará este archivo automáticamente

services:
  # =================================================================
  # WEB SERVICE - Django Multi-Tenant App
  # =================================================================
  - type: web
    name: saasmvp
    runtime: python
    region: oregon
    plan: free
    branch: main
    
    # Build & Start
    buildCommand: "./build.sh"
    startCommand: "gunicorn config.wsgi:application --bind 0.0.0.0:$PORT"
    
    # Health Check
    healthCheckPath: /
    
    # Variables de entorno
    envVars:
      # Python
      - key: PYTHON_VERSION
        value: "3.11.0"
      
      # Django Settings
      - key: DJANGO_SETTINGS_MODULE
        value: config.settings.production
      
      # Seguridad (generada automáticamente)
      - key: SECRET_KEY
        generateValue: true
      
      # Debug (siempre False en producción)
      - key: DEBUG
        value: "False"
      
      # Base de datos (se conecta automáticamente)
      - key: DATABASE_URL
        fromDatabase:
          name: saasmvp-db
          property: connectionString
      
      # ===============================================
      # CONFIGURACIÓN MULTI-TENANT
      # ===============================================
      
      # Dominio base para subdominios (ej: demo.tuapp.cl)
      - key: BASE_DOMAIN
        value: "onrender.com"
      
      # Tenant por defecto (cuando no se detecta dominio)
      - key: DEFAULT_TENANT_SLUG
        value: "servelec"
      
      # Dominios adicionales permitidos (separados por coma)
      # Agregar aquí los dominios de tus clientes
      - key: EXTRA_DOMAINS
        value: "servelec-ingenieria.cl,www.servelec-ingenieria.cl"
      
      # ===============================================
      # EMAIL (Zoho Mail)
      # ===============================================
      - key: EMAIL_HOST
        value: "smtp.zoho.com"
      
      - key: EMAIL_PORT
        value: "587"
      
      - key: EMAIL_USE_TLS
        value: "True"
      
      # Estas las configuras manualmente en Render Dashboard (son secretas)
      # - key: EMAIL_HOST_USER
      #   sync: false
      # - key: EMAIL_HOST_PASSWORD
      #   sync: false

# =================================================================
# DATABASE - PostgreSQL
# =================================================================
databases:
  - name: saasmvp-db
    plan: free
    region: oregon
    # ipAllowList: []  # Permitir todas las IPs (default)